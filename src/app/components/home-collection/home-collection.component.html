<div class="container py-3">
  <h4 class="text-cgreen">Home Sample Collection Booking</h4>
  <hr />
  <div class="patientDetailContainer">
    <div class="row">
      <div class="col-sm">
        <p class="colLabel">
          Patient Details
          <a data-bs-toggle="modal" href="#exampleModalToggle" role="button">
            <i class="bi bi-plus-circle-fill text-cgreen"></i
          ></a>
        </p>
        <p *ngIf="patientDetail">
          <span class="text-capitalize">{{ patientDetail.title }} </span>
          <span class="text-uppercase">
            {{ patientDetail.firstName }} {{ patientDetail.lastName }}</span
          >
          ,
          <span class="text-capitalize">{{ patientDetail.gender }}</span
          >,
          <span class="text-capitalize">{{ patientDetail.ageYear }}</span> Years
          <span class="text-capitalize">{{ patientDetail.ageMonth }}</span>
          Months
        </p>
      </div>
      <div class="col-sm">
        <p class="colLabel">Doctor Name <br /></p>
        <ng-select
          [items]="doctorList"
          bindLabel="name"
          placeholder="Select Doctor..."
          [(ngModel)]="homeCollectionData.selectedDoctor"
          [addTag]="addCustomUser"
        >
        </ng-select>
      </div>
      <div class="col col-sm">
        <p class="colLabel">Lead Source <br /></p>
        <ng-select
          [items]="leadSourceList"
          bindLabel="name"
          placeholder="Select Lead Source..."
          [(ngModel)]="homeCollectionData.selectedLead"
        >
        </ng-select>
      </div>
    </div>
    <div class="row mt-3">
      <div class="col-sm-4 mb-3">
        <p class="colLabel fw-bold">Is B2B User: <br /></p>
        <div class="form-check form-check-inline">
          <input
            class="form-check-input"
            type="radio"
            name="inlineRadioOptions"
            id="inlineRadio1"
            value="true"
            [(ngModel)]="homeCollectionData.isb2buser"
          />
          <label class="form-check-label" for="inlineRadio1">True</label>
        </div>
        <div class="form-check form-check-inline">
          <input
            class="form-check-input"
            type="radio"
            name="inlineRadioOptions"
            id="inlineRadio2"
            value="false"
            [(ngModel)]="homeCollectionData.isb2buser"
          />
          <label class="form-check-label" for="inlineRadio2">False</label>
        </div>
      </div>
      <div class="col-sm-4" *ngIf="homeCollectionData.isb2buser === 'true'">
        <p class="colLabel fw-bold">Client: <br /></p>
        <ng-select
          [items]="clientList"
          bindLabel="name"
          placeholder="Select client..."
          [(ngModel)]="homeCollectionData.selectedClient"
          [addTag]="addCustomUser"
        >
        </ng-select>
      </div>
    </div>
    <div class="row mt-3">
      <div class="col-sm-4">
        <p class="colLabel fw-bold">Select Delivery Address <br /></p>
        <ng-select
          [items]="deliveryAddressList"
          bindLabel="shortName"
          placeholder="Select Delivery Address..."
          [(ngModel)]="homeCollectionData.selectedDeliveryAddress"
          [addTag]="addCustomUser"
          (change)="addnewAddress()"
        >
        </ng-select>
      </div>
      <div class="col-sm-4">
        <p class="colLabel fw-bold">Select Diagonistic Center <br /></p>
        <ng-select
          [items]="diagonasticCenterList"
          bindLabel="name"
          placeholder="Select Center..."
          [(ngModel)]="homeCollectionData.selectedDiagonasticCenter"
          [addTag]="addCustomUser"
        >
        </ng-select>
      </div>
    </div>
    <div
      class="row"
      *ngIf="
        homeCollectionData.selectedDeliveryAddress &&
        homeCollectionData.selectedDeliveryAddress.shortName != 'Add New'
      "
    >
      <div class="col-sm-4">
        <div class="addressSelected mt-3">
          <p class="text-end mb-1" (click)="editAddress()">
            <i class="bi bi-pencil-square"></i>
          </p>
          <p>
            {{ homeCollectionData.selectedDeliveryAddress.shortName }}({{
              homeCollectionData.selectedDeliveryAddress.type
            }})
          </p>
          <p>
            {{ homeCollectionData.selectedDeliveryAddress.landmark }},{{
              homeCollectionData.selectedDeliveryAddress.address1
            }}
          </p>
          <p>{{ homeCollectionData.selectedDeliveryAddress.address2 }}</p>
          <p class="mb-0">
            {{ homeCollectionData.selectedDeliveryAddress.city }},
            {{ homeCollectionData.selectedDeliveryAddress.state }}-{{
              homeCollectionData.selectedDeliveryAddress.pin
            }}
          </p>
        </div>
      </div>
    </div>
    <div class="row">
      <div class="col-sm-8 mt-3">
        <textarea
          class="form-control"
          placeholder="Please add remarks/route if any..."
          [(ngModel)]="homeCollectionData.remarkRoute"
        ></textarea>
      </div>
    </div>
    <div class="row border pt-1 mt-3 mx-0">
      <div class="col-4">Add Diagonistic Test</div>
      <div class="col-4"></div>
      <div class="col-4">
        <!-- <input
          class="form-control form-control-sm"
          type="text"
          placeholder="Search Tests..."
          aria-label=".form-control-sm example"
        /> -->
        <ng-select
          [items]="availableTests"
          bindLabel="testName"
          placeholder="Select Test..."
          [(ngModel)]="homeCollectionData.selectedTest"
          (change)="selectTest($event)"
        >
        </ng-select>
      </div>
      <div class="col-sm-12 border-top mt-1 p-0">
        <table class="table table-striped table-hover mb-0">
          <thead>
            <tr>
              <th scope="col">#</th>
              <th scope="col">Service Name</th>
              <th scope="col">Precausion</th>
              <th scope="col">Price</th>
              <th scope="col" class="text-center">Action</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let test of testsSelected; let i = index">
              <th scope="row">{{ i + 1 }}</th>
              <td>{{ test.testName }}</td>
              <td>{{ test.precausion }}</td>
              <td>{{ test.price }}</td>
              <td class="text-center">
                <i
                  class="bi bi-x-circle-fill text-danger"
                  (click)="removeTest(i)"
                ></i>
              </td>
            </tr>
            <tr *ngIf="testsSelected.length === 0">
              <td colspan="5">
                <p class="text-center m-0">No test Added</p>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>

<!-- collection sample modal -->
<div
  class="modal fade"
  id="exampleModalToggle"
  aria-hidden="true"
  aria-labelledby="exampleModalToggleLabel"
  tabindex="-1"
>
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="exampleModalToggleLabel">
          Patient Details
        </h5>
        <button
          type="button"
          class="btn-close"
          data-bs-dismiss="modal"
          aria-label="Close"
        ></button>
      </div>
      <div class="modal-body">
        <div class="register-form">
          <form [formGroup]="form" (ngSubmit)="onSubmit()">
            <div class="form-group">
              <label>Mobile number*</label>

              <!-- <ng-select
                [items]="patientSourceList"
                bindLabel="name"
                placeholder="Enter Mobile Number..."
                [(ngModel)]="selectedPatient"
                formControlName="mobile"
                [addTag]="addCustomUser"
              >
              </ng-select> -->
              <input
                type="number"
                formControlName="mobile"
                class="form-control form-control-sm"
                [ngClass]="{ 'is-invalid': submitted && f['mobile'].errors }"
                (input)="checkPatient()"
              />
              <div
                *ngIf="submitted && f['mobile'].errors"
                class="invalid-feedback"
              >
                <div *ngIf="f['mobile'].errors['required']">
                  mobile is required
                </div>
                <div *ngIf="f['mobile'].errors['pattern']">
                  Invalid mobile number
                </div>
              </div>
            </div>
            <div
              class="accordion"
              id="accordionExample"
              *ngIf="showpatientList"
            >
              <div class="accordion-item">
                <h2 class="accordion-header" id="headingOne">
                  <button
                    class="accordion-button p-2"
                    type="button"
                    data-bs-toggle="collapse"
                    data-bs-target="#collapseOne"
                    aria-expanded="true"
                    aria-controls="collapseOne"
                  >
                    Existing Patients
                  </button>
                </h2>
                <div
                  id="collapseOne"
                  class="accordion-collapse collapse show"
                  aria-labelledby="headingOne"
                  data-bs-parent="#accordionExample"
                >
                  <div class="accordion-body p-0">
                    <div class="existingPatientList row m-0">
                      <label
                        class="radio col-6"
                        *ngFor="let item of patientSourceList"
                      >
                        <input
                          type="radio"
                          name="patientName"
                          [value]="item"
                          [(ngModel)]="selectedPatient"
                          [ngModelOptions]="{ standalone: true }"
                          (change)="updateFormData()"
                        />
                        <span class="text-capitalize"
                          >{{ item.firstName }} {{ item.lastName }} ({{
                            item?.belongTo ? "Self" : "Other"
                          }})</span
                        >
                        <i
                          *ngIf="selectedPatient?.id === item.id"
                          class="bi bi-check-circle text-cgreen patientCheckIcon"
                        ></i>
                      </label>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <div class="form-group">
              <label>Title*</label>
              <select
                formControlName="title"
                class="form-control form-control-sm"
                [ngClass]="{ 'is-invalid': submitted && f['title'].errors }"
              >
                <option [value]="'mr.'">Mr.</option>
                <option [value]="'mrs.'">Mrs.</option>
                <option [value]="'ms.'">Ms.</option>
                <option [value]="'other'">Other</option>
              </select>
              <div
                *ngIf="submitted && f['title'].errors"
                class="invalid-feedback"
              >
                <div *ngIf="f['title'].errors['required']">
                  Title is required
                </div>
              </div>
            </div>
            <div class="form-group">
              <label>First Name*</label>
              <input
                type="text"
                formControlName="firstName"
                class="form-control form-control-sm"
                [ngClass]="{ 'is-invalid': submitted && f['firstName'].errors }"
              />
              <div
                *ngIf="submitted && f['firstName'].errors"
                class="invalid-feedback"
              >
                <div *ngIf="f['firstName'].errors['required']">
                  First Name is required
                </div>
              </div>
            </div>
            <div class="form-group">
              <label>Last Name</label>
              <input
                type="text"
                formControlName="lastName"
                class="form-control form-control-sm"
              />
            </div>

            <div class="form-group">
              <label>Last Visited Date</label>
              <input
                type="date"
                formControlName="lastVisitDate"
                class="form-control form-control-sm"
              />
            </div>
            <div class="form-group">
              <label>Age*</label>
              <div class="row">
                <div class="input-group mb-3 col">
                  <input
                    type="number"
                    class="form-control form-control-sm"
                    placeholder="year"
                    aria-label="year"
                    aria-describedby="basic-addon1"
                    formControlName="ageYear"
                    [ngClass]="{
                      'is-invalid': submitted && f['ageYear'].errors
                    }"
                  />

                  <span class="input-group-text" id="basic-addon1">Year</span>
                  <div
                    *ngIf="submitted && f['ageYear'].errors"
                    class="invalid-feedback"
                  >
                    <div *ngIf="f['ageYear'].errors['required']">
                      Year is required
                    </div>
                  </div>
                </div>
                <div class="input-group mb-3 col">
                  <input
                    type="number"
                    class="form-control form-control-sm"
                    placeholder="Month..."
                    aria-label="month"
                    aria-describedby="basic-addon1"
                    formControlName="ageMonth"
                    [ngClass]="{
                      'is-invalid': submitted && f['ageMonth'].errors
                    }"
                  />
                  <span class="input-group-text" id="basic-addon1">Month</span>
                  <div
                    *ngIf="submitted && f['ageMonth'].errors"
                    class="invalid-feedback"
                  >
                    <div *ngIf="f['ageMonth'].errors['required']">
                      Month is required
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div class="form-group">
              <label>Gender</label><br />
              <div class="form-check form-check-inline">
                <input
                  class="form-check-input"
                  type="radio"
                  id="inlineRadio1"
                  value="male"
                  formControlName="gender"
                />
                <label class="form-check-label" for="inlineRadio1">Male</label>
              </div>
              <div class="form-check form-check-inline">
                <input
                  class="form-check-input"
                  type="radio"
                  id="inlineRadio2"
                  value="female"
                  formControlName="gender"
                />
                <label class="form-check-label" for="inlineRadio2"
                  >Female</label
                >
              </div>
              <div class="form-check form-check-inline">
                <input
                  class="form-check-input"
                  type="radio"
                  id="inlineRadio3"
                  value="other"
                  formControlName="gender"
                />
                <label class="form-check-label" for="inlineRadio3">Other</label>
              </div>
            </div>
            <div class="form-group">
              <label>Email*</label>
              <input
                type="text"
                formControlName="email"
                class="form-control form-control-sm"
                [ngClass]="{ 'is-invalid': submitted && f['email'].errors }"
              />
              <div
                *ngIf="submitted && f['email'].errors"
                class="invalid-feedback"
              >
                <div *ngIf="f['email'].errors['required']">
                  Email is required
                </div>
                <div *ngIf="f['email'].errors['email']">Email is invalid</div>
              </div>
            </div>
            <div class="form-group">
              <label>Alternative Mobile</label>
              <input
                type="number"
                formControlName="alternateMobile"
                class="form-control form-control-sm"
              />
            </div>
          </form>
        </div>
      </div>
      <div class="modal-footer">
        <button
          [disabled]="form.invalid"
          type="submit"
          class="btn btn-primary"
          data-bs-target="#exampleModalToggle"
          data-bs-toggle="modal"
          data-bs-dismiss="modal"
          (click)="onSubmit()"
        >
          Proceed
        </button>
        <button
          type="button"
          (click)="onReset()"
          class="btn btn-warning float-right"
          data-bs-target="#exampleModalToggle"
          data-bs-toggle="modal"
          data-bs-dismiss="modal"
        >
          Reset
        </button>
      </div>
    </div>
  </div>
</div>
<!-- end collection sample modal -->

<!-- addnew address form -->
<div
  class="modal fade"
  id="addNewAddressFormModal"
  aria-hidden="true"
  aria-labelledby="addNewAddressFormModalLabel"
  tabindex="-1"
>
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="addNewAddressFormModalLabel">
          New Address
        </h5>
        <button
          type="button"
          class="btn-close"
          data-bs-dismiss="modal"
          aria-label="Close"
        ></button>
      </div>
      <div class="modal-body">
        <div class="register-form">
          <form [formGroup]="addressForm" (ngSubmit)="onAddressSubmit()">
            <div class="form-group">
              <label>Address Type*</label>
              <select
                class="form-select"
                aria-label="Default select example"
                formControlName="type"
                class="form-select form-control form-control-sm"
                [ngClass]="{
                  'is-invalid': submittedAdd && addf['type'].errors
                }"
              >
                <option value="home">Home</option>
                <option value="office">Office</option>
                <option value="other">Other</option>
              </select>
              <div
                *ngIf="submittedAdd && addf['type'].errors"
                class="invalid-feedback"
              >
                <div *ngIf="addf['type'].errors['required']">
                  type is required
                </div>
              </div>
            </div>
            <div class="form-group">
              <label>Address short Name*</label>
              <input
                type="text"
                formControlName="shortName"
                class="form-control form-control-sm"
                [ngClass]="{
                  'is-invalid': submittedAdd && addf['shortName'].errors
                }"
              />
              <div
                *ngIf="submittedAdd && addf['shortName'].errors"
                class="invalid-feedback"
              >
                <div *ngIf="addf['shortName'].errors['required']">
                  Short Name for address is required
                </div>
              </div>
            </div>
            <div class="form-group">
              <label>Address Line 1*</label>
              <input
                type="text"
                formControlName="address1"
                class="form-control form-control-sm"
                [ngClass]="{
                  'is-invalid': submittedAdd && addf['address1'].errors
                }"
              />
              <div
                *ngIf="submittedAdd && addf['address1'].errors"
                class="invalid-feedback"
              >
                <div *ngIf="addf['address1'].errors['required']">
                  Address Line 1 is required
                </div>
              </div>
            </div>
            <div class="form-group">
              <label>Address Line 2*</label>
              <input
                type="text"
                formControlName="address2"
                class="form-control form-control-sm"
                [ngClass]="{
                  'is-invalid': submittedAdd && addf['address2'].errors
                }"
              />
              <div
                *ngIf="submittedAdd && addf['address2'].errors"
                class="invalid-feedback"
              >
                <div *ngIf="addf['address2'].errors['required']">
                  Address Line 2 is required
                </div>
              </div>
            </div>
            <div class="form-group">
              <label>Landmark*</label>
              <input
                type="text"
                formControlName="landmark"
                class="form-control form-control-sm"
                [ngClass]="{
                  'is-invalid': submittedAdd && addf['landmark'].errors
                }"
              />
              <div
                *ngIf="submittedAdd && addf['landmark'].errors"
                class="invalid-feedback"
              >
                <div *ngIf="addf['landmark'].errors['required']">
                  Landmark is required
                </div>
              </div>
            </div>
            <div class="form-group">
              <label>Pin Code*</label>
              <input
                type="text"
                formControlName="pin"
                class="form-control form-control-sm"
                [ngClass]="{
                  'is-invalid': submittedAdd && addf['pin'].errors
                }"
              />
              <div
                *ngIf="submittedAdd && addf['pin'].errors"
                class="invalid-feedback"
              >
                <div *ngIf="addf['pin'].errors['required']">
                  Pin is required
                </div>
              </div>
            </div>
            <div class="form-group">
              <label>Area*</label>
              <input
                type="text"
                formControlName="area"
                class="form-control form-control-sm"
                [ngClass]="{
                  'is-invalid': submittedAdd && addf['area'].errors
                }"
              />
              <div
                *ngIf="submittedAdd && addf['area'].errors"
                class="invalid-feedback"
              >
                <div *ngIf="addf['area'].errors['required']">
                  Area is required
                </div>
              </div>
            </div>
            <div class="form-group">
              <label>City*</label>
              <input
                type="text"
                formControlName="city"
                class="form-control form-control-sm"
                [ngClass]="{
                  'is-invalid': submittedAdd && addf['city'].errors
                }"
              />
              <div
                *ngIf="submittedAdd && addf['city'].errors"
                class="invalid-feedback"
              >
                <div *ngIf="addf['city'].errors['required']">
                  Address Line 1 is required
                </div>
              </div>
            </div>
            <div class="form-group">
              <label>State*</label>
              <input
                type="text"
                formControlName="state"
                class="form-control form-control-sm"
                [ngClass]="{
                  'is-invalid': submittedAdd && addf['state'].errors
                }"
              />
              <div
                *ngIf="submittedAdd && addf['state'].errors"
                class="invalid-feedback"
              >
                <div *ngIf="addf['state'].errors['required']">
                  Address Line 1 is required
                </div>
              </div>
            </div>
          </form>
        </div>
      </div>
      <div class="modal-footer">
        <button
          [disabled]="addressForm.invalid"
          type="submit"
          class="btn btn-primary"
          data-bs-target="#addNewAddressFormModal"
          data-bs-toggle="modal"
          data-bs-dismiss="modal"
          (click)="onAddressSubmit()"
        >
          Proceed
        </button>
        <!-- <button
          type="button"
          class="btn btn-warning float-right"
          data-bs-target="#addNewAddressFormModal"
          data-bs-toggle="modal"
          data-bs-dismiss="modal"
        >
          Close
        </button> -->
      </div>
    </div>
  </div>
</div>
<button
  type="button"
  data-bs-toggle="modal"
  href="#addNewAddressFormModal"
  role="button"
  #addressModalBtnOpen
>
  Launch modal
</button>
<!--end addnew address form -->
